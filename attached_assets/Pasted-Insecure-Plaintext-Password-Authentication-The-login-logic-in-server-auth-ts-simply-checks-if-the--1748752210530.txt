Insecure Plaintext Password Authentication â€“ The login logic in server/auth.ts simply checks if the provided password is "password" or matches the userâ€™s email
GitHub
. This means any account can be accessed with a default or known string, a severe security risk. It completely bypasses real password authentication, violating enterprise security standards. Even if it â€œworksâ€ for dev, itâ€™s highly suspicious in production.
â— Why it matters: Attackers could trivially breach any userâ€™s account, compromising all tenant data. There is no hashing or validation â€“ a critical violation of security best practices.
ğŸ”® Suspicious even if working: A comment in code admits this is a temporary measure and proper hashing is missing
GitHub
. Relying on it in a live system is dangerous, even if it â€œworksâ€ for demo logins.
âœ… Fix: Integrate a robust password hashing mechanism (e.g. bcrypt with the provided salt rounds env setting) and store hashed passwords. Remove the hardcoded check. On login, hash the input password and compare with the stored hash. If using Supabase for auth, delegate verification to Supabase and remove this code.
ğŸ§  Replit AI Prompt: â€œIn server/auth.ts, replace the dummy password check with bcrypt hashing. Generate and store password hashes for users and verify them on login. Ensure the fix uses BCRYPT_SALT_ROUNDS from env for hashing.â€
ğŸ§ª Tests: After refactoring, attempt logins with correct password vs. â€œpasswordâ€ to ensure only the real password works. Try logging in with an email as the password (previously allowed) â€“ it should now fail. Also test creating a user and logging in to verify the hashing flow.
Cross-Tenant Analytics Data Exposure â€“ The analytics endpoint logic allows an organization admin to access system-wide analytics. In server/routes.ts for /api/analytics, if no specific userId is requested, any user with role â€œadminâ€ (not just a platform super-admin) can fetch global stats
GitHub
. The underlying query getAnalytics() aggregates all trips/users across tenants with no org filter
GitHub
, meaning an org admin could see total users, trips, etc. of other organizations.
â— Why it matters: This violates cross-tenant isolation. One customerâ€™s admin could glean another tenantâ€™s usage metrics, undermining data confidentiality. Enterprise clients expect that no tenant can ever see anotherâ€™s data.
ğŸ”® Suspicious even if technically working: The code explicitly only restricts non-admin roles
GitHub
, implying org admins are treated like super-users. Thatâ€™s likely an oversight â€“ â€œadminâ€ usually means org-level admin, not a global platform admin. Itâ€™s a red flag that a tenant admin has such broad access.
âœ… Fix: Restrict global analytics to super_admin role only. In the /api/analytics handler, change the role check to allow only super_admin for the system-wide branch. Alternatively, scope the analytics queries by req.user.organizationId for org admins so they see only their orgâ€™s stats. E.g. modify getAnalytics() to accept an optional orgId and filter counts (e.g., WHERE organization_id = X) if provided.
ğŸ§  Replit AI Prompt: â€œIn the analytics route, ensure that only super_admin can access system-wide metrics. Update the role check and have org admins default to organization-scoped analytics. Implement an organizationId filter in analytics queries so org admins see only their orgâ€™s data.â€
ğŸ§ª Tests: Log in as an org admin (non-super) and call GET /api/analytics. It should not return other organizationsâ€™ totals (either reject with 403 or return only that orgâ€™s data). As a super_admin, calling the endpoint should still return the full system analytics. Also test GET /api/analytics?userId=X for cross-org user IDs: ensure a non-super admin cannot fetch another orgâ€™s user analytics (should get 403).
Team Invitation Impersonation & Privilege Bypass â€“ The team invite creation API (POST /api/invitations) trusts a client-supplied header x-user-id to identify the inviter
GitHub
, instead of using the sessionâ€™s user. There is no role check â€“ any logged-in user could attempt this. The code then loads whatever user ID was provided and uses that userâ€™s organization to create an invitation
GitHub
. This means a malicious user could supply another userâ€™s ID (even from another org) and create invites under that org.
â— Why it matters: Relying on client input for user identity is a major security flaw. An attacker could potentially invite themselves into a different tenantâ€™s team or perform admin-only actions. Lack of role verification means even basic users could send invites (possibly to elevate their own access). Cross-org authorization is broken here.
ğŸ”® Suspicious even if working: Itâ€™s unusual that the server doesnâ€™t simply use req.user. The presence of x-user-id hints that something is off with how the front-end or API is designed. Even if it â€œworksâ€ when the correct header is sent, itâ€™s an unsafe design â€“ essentially trusting user-provided identity.
âœ… Fix: Use the authenticated session user for invite actions. Remove the x-user-id usage entirely; instead, get inviterUserId from req.user.id (set by unifiedAuthMiddleware). Also enforce that only authorized roles (e.g. org admin/manager) can invite. Implement a check like: if (req.user.role !== 'admin' && req.user.role !== 'manager') return 403. Ensure the inviteâ€™s organizationId is req.user.organizationId (already inherently true if using the session user).
ğŸ§  Replit AI Prompt: â€œRefactor the /api/invitations POST handler in server/routes.ts: use req.user.id and req.user.organizationId instead of x-user-id. Add a role guard so that only users with admin privileges can create invitations. Remove any client-supplied user ID trust.â€
ğŸ§ª Tests: With the fix, test creating invites: as an admin user (role Admin) call the endpoint (no special header needed) â€“ it should succeed and issue an email (simulate the send). As a non-admin user, the endpoint should now reject with 403. Also attempt to spoof another ID by sending an x-user-id: the server should ignore it, preventing cross-org invite creation. Validate that the invitationâ€™s organizationId always matches the inviterâ€™s org.
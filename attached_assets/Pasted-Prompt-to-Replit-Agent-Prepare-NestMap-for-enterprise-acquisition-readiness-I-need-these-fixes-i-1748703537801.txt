Prompt to Replit Agent:

â€œPrepare NestMap for enterprise acquisition readiness. I need these fixes implemented across the codebase in atomic commits with full comments and clear file-level diffs:â€

â¸»

ğŸ” Authentication & Authorization Fixes

â€œUnify auth to Supabase only. Remove Passport.js and session logic entirely. Migrate all login/logout/session logic to JWT or Supabase client sessions. Fix redundant auth middleware.â€

Why? Simplifies dev handoff, removes unnecessary dual systems.

â¸»

ğŸ§¹ Code Cleanup & Technical Debt

â€œScan all middleware and routes for unused files or partial refactors. Remove unused files like fileUploadSecurity.ts. Fix all TypeScript compilation errors. Run tsc --noEmit and resolve all type issues.â€

Why? No one wants to buy a codebase with compile errors.

â¸»

ğŸ§ª Automated Testing Suite

â€œAdd automated tests for key routes: /api/auth, /api/trips, /api/analytics, /api/proposals. Use Jest + Supertest. Include one test per route minimum for authentication, org-scoping, and success/error handling.â€

Why? This signals reliability and reduces buyer hesitation.

â¸»

ğŸ”§ Migrations & DB Strategy

â€œReplace Drizzleâ€™s push system with proper migrations/ files. Add indexes to all organization_id and user_id fields. Add test migration logs. Ensure rollback support.â€

Why? Push-only DB changes scare buyers. Migrations are must-have.

â¸»

ğŸ“¦ API Structure and Versioning

â€œMove all API routes to /api/v1/ namespace. Prepare v2 routing folder (even if empty). Add middleware for version negotiation and deprecation warning headers.â€

Why? Signals long-term stability and scalability.

â¸»

ğŸ“Š Analytics Fixes

**â€œFix all analytics endpoints to:

	1.	Enforce org-based filtering on every query
	2.	Use logged-in userâ€™s org ID from session
	3.	Prevent role leakage (only allow access to matching roles)â€**

Why? You cannot leak enterprise data across clients.

â¸»

ğŸŒ White-label & Branding Cleanup

â€œConsolidate all branding config (colors, logo, name) into /config/branding.ts. Replace hardcoded â€˜NestMapâ€™ strings with dynamic fallback using process.env.DEFAULT_BRAND_NAME. Fix all subdomain-based routing to load proper org branding dynamically.â€

Why? White-label must be hands-off and centralized.

â¸»

ğŸ“ˆ Performance + Monitoring

â€œImplement express-status-monitor or similar lightweight tool for server performance dashboard. Add /api/health endpoint for uptime checks. Add logging middleware that logs user ID, org ID, and endpoint.â€

Why? Enterprise buyers want monitoring hooks out of the box.

â¸»

âš™ï¸ DevOps Readiness

**â€œAdd .github/workflows/main.yml CI pipeline with steps:

	1.	Install deps
	2.	Run tsc --noEmit
	3.	Run eslint
	4.	Run jest
	5.	Lint Dockerfile and check railway.json syntaxâ€**

Why? This creates confidence and signals production maturity.

â¸»

ğŸ§¾ Licensing & Compliance

â€œAudit all installed packages with npm audit and license-checker. Fix any vulnerable packages. Remove unlicensed or questionable sources. Create LICENSE-THIRD-PARTY.md for buyers.â€

Why? No buyer wants hidden legal risk.
